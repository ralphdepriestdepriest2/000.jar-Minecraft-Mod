package nothing.its.real.procedures;

import nothing.its.real.init.Ashes1ashesModParticleTypes;
import nothing.its.real.entity.VillagrrEntity;
import nothing.its.real.entity.NEntity;
import nothing.its.real.configuration.ConfiguracionConfiguration;

import net.minecraftforge.fml.common.Mod;
import net.minecraftforge.eventbus.api.SubscribeEvent;
import net.minecraftforge.eventbus.api.Event;
import net.minecraftforge.event.TickEvent;

import net.minecraft.world.phys.Vec3;
import net.minecraft.world.phys.Vec2;
import net.minecraft.world.phys.AABB;
import net.minecraft.world.level.LevelAccessor;
import net.minecraft.world.entity.Entity;
import net.minecraft.server.level.ServerPlayer;
import net.minecraft.server.level.ServerLevel;
import net.minecraft.resources.ResourceLocation;
import net.minecraft.network.chat.Component;
import net.minecraft.core.particles.SimpleParticleType;
import net.minecraft.commands.CommandSourceStack;
import net.minecraft.commands.CommandSource;
import net.minecraft.advancements.AdvancementProgress;
import net.minecraft.advancements.Advancement;

import javax.annotation.Nullable;

@Mod.EventBusSubscriber
public class PunteroProcedure {
	@SubscribeEvent
	public static void onPlayerTick(TickEvent.PlayerTickEvent event) {
		if (event.phase == TickEvent.Phase.END) {
			execute(event, event.player.level, event.player.getX(), event.player.getY(), event.player.getZ(), event.player);
		}
	}

	public static void execute(LevelAccessor world, double x, double y, double z, Entity entity) {
		execute(null, world, x, y, z, entity);
	}

	private static void execute(@Nullable Event event, LevelAccessor world, double x, double y, double z, Entity entity) {
		if (entity == null)
			return;
		double puntero = 0;
		double puntero2 = 0;
		if (!world.getEntitiesOfClass(NEntity.class, AABB.ofSize(new Vec3(x, y, z), 100, 100, 100), e -> true).isEmpty()) {
			puntero = 0.5;
			world.addParticle((SimpleParticleType) (Ashes1ashesModParticleTypes.PUNTO_NEGRO.get()), (entity.getX() + entity.getLookAngle().x * puntero), (entity.getY() + 1.62 + entity.getLookAngle().y * puntero),
					(entity.getZ() + entity.getLookAngle().z * puntero), 0, 0, 0);
			if (entity instanceof ServerPlayer _player) {
				Advancement _adv = _player.server.getAdvancements().getAdvancement(new ResourceLocation("ashes1ashes:nadvance"));
				AdvancementProgress _ap = _player.getAdvancements().getOrStartProgress(_adv);
				if (!_ap.isDone()) {
					for (String criteria : _ap.getRemainingCriteria())
						_player.getAdvancements().award(_adv, criteria);
				}
			}
			if (ConfiguracionConfiguration.CHATFLOODEYE.get()) {
				if (!world.isClientSide() && world.getServer() != null)
					world.getServer().getPlayerList().broadcastSystemMessage(Component.literal(
							"\u00A74\u00A7kd\u0337\u030D\u0304\u035B\u0302\u0300\u0348\u0328\u0349\u0353\u0353\u0329\u035A\u0325\u0317\u0319\u032F\u0331\u0348\u0348\u0326\u0326\u0326\u0355\u0329\u0327\u0326\u032B\u033A\u031E\u0333\u0326\u035C\u035C\u0347\u032B\u0330\u031C\u032E\u0332\u032Da\u0334\u0352\u0307\u0315\u034C\u035D\u030C\u0350\u030C\u0344\u0312\u0342\u0345\u0348\u0331\u0322\u0318\u0330\u0326\u0322\u031E\u032C\u032D\u0325\u032D\u0325\u0353\u0325\u031E\u0355\u0316\u032D\u0328\u035C\u032C\u0359\u0347\u0329\u0345\u0330\u033A\u0325\u0327\u032Fr\u0337\u031B\u0313\u033D\u030B\u0314\u0306\u030F\u0342\u0305\u035B\u031B\u0352\u0300\u0344\u0305\u0344\u031A\u0311\u0300\u030F\u030F\u0308\u0307\u035B\u0315\u0350\u0307\u0302\u0308\u030D\u0360\u0302\u034C\u031C\u0326\u033B\u0339\u032D\u032E\u0325\u032C\u033B\u0323\u0339\u0319\u0317\u0316\u035A\u032E\u0323\u0328\u0348\u0333\u032F\u0321\u032A\u033B\u031D\u032C\u031C\u0353\u032A\u0326\u0348\u0319\u031C\u035A\u031C\u0326\u031D\u0339\u0321\u0321\u0345\u0324k\u0337\u0344\u0309\u0356\u033A\u0349\u0316\u0332\u032A\u034E\u0321\u032A\u034E\u033A\u0327\u0355\u034D\u0348\u0339\u033C\u0345\u032Cn\u0338\u0351\u0360\u031A\u0315\u033F\u034A\u0357\u031B\u031A\u034B\u0305\u0360\u034C\u0351\u031A\u0341\u034B\u030B\u030D\u033F\u030A\u034B\u035B\u034A\u0312\u0360\u034B\u033D\u030F\u0309\u030C\u0311\u0300\u0344\u035D\u031B\u0340\u0303\u035D\u0358\u0308\u034B\u0309\u0300\u0352\u031A\u0342\u0351\u032D\u0359\u0331\u0327\u0327\u032F\u033A\u035A\u0318\u035A\u031E\u0330\u0348\u0324\u034D\u0325\u0359\u0325\u032F\u032C\u033C\u0326\u0333\u033B\u031D\u033C\u032E\u031E\u035A\u0359\u0324\u032A\u0359\u031C\u0326\u034E\u0345\u0326\u0347e\u0336\u030E\u030C\u030E\u033F\u033E\u030A\u0360\u0302\u0346\u030E\u0301\u0351\u0301\u0351\u030D\u0305\u0360\u035B\u0350\u030A\u0352\u0343\u0306\u0310\u030B\u0351\u034A\u030F\u0311\u0310\u033F\u0315\u0344\u034A\u0343\u0300\u0340\u0344\u0350\u0304\u0303\u0305\u0311\u0304\u0305\u0315\u0312\u0360\u035D\u0359\u0322\u0323\u032F\u0326\u0328\u0328\u0332\u0354\u0345\u031E\u031C\u0325\u0329s\u0338\u035D\u034A\u030C\u0315\u0304\u0343\u0342\u0344\u0305\u034B\u0311\u0342\u0359\u0328\u032F\u0322\u034E\u032E\u032C\u034E\u0328\u0327\u0345\u0349\u0323\u035C\u034E\u0355\u032C\u0355\u033C\u035A\u0316\u033B\u031E\u0332\u0325\u0325\u0321\u031E\u031F\u032A\u0339\u033A\u032D\u033A\u032E\u0345s\u0336\u030A\u031A\u030A\u0307\u0308\u033D\u0340\u0343\u0312\u034A\u030A\u0358\u0314\u0350\u0301\u0306\u0340\u0312\u035B\u0351\u034C\u0352\u0360\u0307\u0352\u0341\u031A\u0309\u030A\u033F\u0304\u0360\u030C\u0307\u0315\u034A\u030A\u0342\u0332\u032C\u034D\u032E \u0337\u0314\u0343\u0360\u0302\u0347\u0349\u0324\u0359\u0359\u0321\u032A\u031E\u0326\u0347\u0318\u0330\u033C\u031F\u0322\u0330\u032D\u0327\u0320\u0324\u0326\u0354\u0353\u0321\u0359\u0348\u033C\u032F\u032D\u034E\u0353\u0327\u0347\u0326\u034D\u0355\u033B\u0323\u0359i\u0338\u0306\u034A\u034C\u0309\u0315\u031A\u034C\u033D\u0315\u0342\u030B\u0357\u0304\u0346\u0312\u0343\u034A\u0301\u030E\u030F\u030F\u032C\u034D\u033C\u032C\u0349\u034E\u031F\u0329\u035A\u032E\u0317\u033B\u0321\u0328\u0319\u031Cs\u0337\u0300\u0304\u030C\u035B\u0315\u0300\u0312\u0310\u0307\u030B\u0302\u033D\u0303\u0343\u031A\u0344\u030C\u0303\u0340\u035B\u030D\u0360\u0301\u033E\u032E\u0324\u0324\u0319 \u0335\u0307\u0313\u030E\u0342\u034B\u0306\u030F\u030E\u0351\u030B\u0340\u0358\u0344\u0305\u035D\u035B\u031B\u0344\u034B\u0307\u0307\u0314\u0301\u0302\u030D\u0360\u0309\u0300\u0313\u030F\u030E\u030A\u0307\u035B\u0315\u0325\u031F\u033C\u0316\u034E\u032D\u0354\u0323\u031D\u0355\u0353\u0316\u0319\u0333\u033C\u0318\u0325\u0332\u033C\u0345\u0318\u0322\u031D\u0324\u0347\u0324\u0332\u0322\u0331\u0319\u0339\u034E\u0332\u0345\u033C\u0347\u031C\u0356\u034D\u032Eb\u0336\u030C\u0344\u0314\u0308\u034A\u030A\u034C\u0306\u030B\u0346\u0352\u0315\u030E\u0302\u030A\u030C\u0312\u0311\u0351\u0346\u0312\u0346\u033D\u0311\u0342\u0308\u0346\u0302\u034B\u0308\u031A\u030E\u0301\u030A\u0342\u0357\u030F\u033B\u0356\u034E\u035C\u031F\u0331\u0321\u034E\u033A\u0321e\u0335\u0358\u033D\u033E\u034B\u0343\u031B\u034A\u030A\u0300\u033F\u0344\u0344\u0352\u030B\u031B\u030C\u030C\u0306\u0357\u0345\u0322\u033B\u0317\u0356\u0345\u032A\u031C\u0325\u031F\u0329\u0316\u0356\u034E\u0325\u0319\u0354\u0348\u0345\u032B\u0330\u0330\u0329t\u0336\u0311\u0342\u030F\u0307\u0351\u034C\u033D\u031B\u0315\u030F\u0301\u0343\u0308\u031A\u031A\u0360\u031B\u031A\u0306\u033F\u0308\u0306\u033E\u0301\u0350\u0359\u0339\u032Dt\u0338\u030F\u031B\u035B\u035B\u0315\u0358\u033F\u0360\u0305\u0344\u0315\u0352\u030F\u0358\u0314\u0300\u030D\u0304\u031B\u030B\u0308\u0360\u033D\u0340\u030B\u0357\u030D\u0360\u0360\u035D\u0311\u0315\u0358\u0346\u0344\u035D\u033F\u0360\u0340\u0343\u0304\u033E\u034Ee\u0337\u0302\u0301\u0313\u0357\u035B\u031A\u033E\u035D\u030F\u030C\u0340\u030A\u035B\u0352\u0360\u0302\u0350\u035D\u0310\u032A\u033C\u0324\u031F\u0324\u0349\u0347\u035A\u0332\u0323\u033C\u031D\u0348\u032A\u0323\u0317\u0359\u032C\u031F\u031C\u0318\u032D\u031E\u0323\u0326r\u0335\u034C\u0344\u030C\u030C\u0300\u0314\u0351\u035D\u035D\u0346\u0302\u0304\u0306\u0312\u030A\u0313\u030C\u035B\u033E\u0357\u0313\u0343\u0352\u030D\u030A\u0306\u0301\u0360\u0311\u030D\u0340\u034B\u0308\u0340\u034B\u031C\u0348\u0320\u032C\u0328\u032D\u0327\u0320\u034E\u031F\u032F\u034D\u0339\u0317\u035A\u0345\u035A\u0356\u0354\u032B\u031E\u032D\u0323\u0356\u035C\u0349\u033B\u0327\u0349\u0330\u0326\u0356\u0325\u034E\u034E\u035C\u035A\u0345\u0349\u0356 \u0335\u030B\u0341\u031A\u031A\u035B\u030D\u0341\u030D\u034B\u0306\u035B\u030A\u0310\u030D\u035B\u030F\u030C\u0340\u0350\u0341\u033F\u0302\u0342\u031A\u0358\u0315\u0302\u0311\u0323\u0354\u0326\u0326\u0329\u032D\u0317\u032B\u0339\u031D\u0348\u0345\u0322\u0347\u035A\u035C\u031D\u0328\u0354\u0317\u0355\u031F\u0355\u0316\u033C\u035C\u0322\u035A\u0326\u031Ct\u0335\u0304\u0309\u0352\u0302\u0314\u030D\u0350\u0302\u033F\u0357\u0346\u0300\u032F\u0326\u032E\u032D\u0347\u0320\u033A\u034E\u0320\u0359\u031E\u032F\u0317\u0320\u034E\u0345\u0354\u033C\u0356\u033A\u0322\u035C\u0323\u034D\u0345h\u0336\u0310\u0350\u0302\u0306\u0312\u031A\u0300\u0309\u0306\u031A\u030E\u030C\u0306\u0343\u0301\u034B\u0302\u0303\u033E\u0351\u0311\u030D\u0344\u030B\u0340\u034B\u0344\u035B\u0351\u0302\u0306\u0303\u033D\u0313\u0351\u0350\u0342\u0307\u031A\u033D\u0344\u035D\u0309\u034C\u0329\u031D\u0322\u0331\u032F\u0345\u0348\u032B\u0345\u032F\u0318a\u0336\u0351\u033E\u0341\u030A\u0344\u0340\u0312\u0309\u0314\u033F\u035D\u033D\u0306\u0302\u0300\u0309\u0346\u035D\u034B\u0333\u0326\u0345\u0317\u0355\u034D\u0317\u034E\u031E\u0317\u032B\u032F\u032B\u0326\u032D\u0318\u033C\u0330\u033B\u0317\u0359\u032A\u0331\u0354\u0348\u0325\u032E\u033C\u0354\u0353\u0325\u0326\u0325\u0332\u0333\u032E\u033A\u031F\u0328\u035A\u031C\u035C\u033C\u0349\u032C\u0324n\u0335\u030A\u030D\u0360\u030A\u0332\u0319\u0322\u0349\u035C\u0320\u031F \u0334\u034A\u0307\u0344\u0322n\u0335\u0305\u030B\u030A\u0357\u0301\u0301\u0344\u0358\u0304\u035B\u0344\u0344\u033F\u0353\u0332\u0325\u0316\u0353\u0329\u0347\u033B\u0327\u0324\u0317\u0331\u0325\u0329\u0355\u031D\u0348\u0317\u0339\u0323\u0317\u0348\u0354\u0327\u0318\u0349\u0332\u0355\u0327\u0330\u0353\u0347\u0347\u0356\u031F\u0320\u035C\u033A\u032D\u0320o\u0337\u0307\u0313\u0314\u0311\u030F\u0310\u0314\u0344\u0352\u030F\u0352\u035D\u030B\u0311\u0346\u030D\u0342\u0351\u0357\u033F\u0312\u030D\u034C\u0314\u0300\u0358\u0301\u0300\u034C\u035B\u030B\u0310\u0340\u0344\u0344\u030F\u0315\u033D\u0358\u034B\u030F\u0352\u0342\u0306\u031A\u034C\u0323\u0326\u033B\u034D\u0359\u0316\u034D\u034D\u0324t\u0338\u0340\u035D\u033E\u0357\u0351\u0310\u0346\u0311\u030F\u0357\u034B\u0350\u0360\u0314\u0357\u035D\u0301\u0306\u031A\u0343\u033F\u0313\u0304\u0360\u035D\u035D\u0360\u033D\u033E\u0343\u030F\u0343\u033B\u031C\u034D\u031E\u0318\u033C\u034E\u033C\u032F\u0332\u0348\u0353\u035C\u0325\u032B\u033B\u0349\u0355\u0355\u031D\u034D\u033C\u032D\u0353\u0324\u032A\u0353\u0359\u034E\u035Ch\u0337\u0350\u030A\u0310\u030F\u0302\u0352\u030C\u0357\u0307\u030F\u0311\u0301\u0312\u0340\u0352\u0310\u0304\u030B\u0310\u0308\u0315\u0304\u0315\u030F\u030E\u0328\u0321\u0326\u0324\u0349\u0319\u0325\u032E\u031D\u033C\u0347\u031D\u0329\u0356\u032C\u0320\u0326\u032B\u0333\u032C\u0339\u0333\u031D\u031E\u0348i\u0336\u0344\u0342\u0360\u030C\u0313\u0308\u034C\u0357\u035D\u030A\u033F\u035B\u033F\u0343\u0352\u0304\u0303\u0346\u0311\u0308\u0344\u032C\u0331\u032D\u0349\u0345\u0320\u0322\u0321\u0353\u033C\u0333\u031C\u0317\u032B\u0316\u0323\u0333\u0356\u0328\u0349\u0354\u0321\u0327\u032E\u0339\u0347\u0355\u0325\u0330\u0325\u031F\u0354\u0348\u0330n\u0335\u031A\u0307\u0358\u030D\u0304\u0313\u033E\u0309\u0311\u0315\u035D\u0300\u033D\u030A\u030D\u0307\u030E\u030A\u0357\u0313\u0302\u031B\u0306\u0357\u030B\u0340\u0344\u0304\u0350\u0306\u0311\u035D\u031A\u0300\u0313\u030A\u0300\u0324\u033C\u032B\u0353\u0359\u0329\u0353\u032C\u0318\u032F\u0339\u034D\u032Bg\u0338\u0342\u0344\u0342\u0311\u0307\u031B\u0309\u0343\u0313\u035D\u0312\u0344\u030F\u034C\u035D\u0360\u033D\u033F\u0314\u030F\u032D\u0323\u0331\u0356\u0356\u034D\u0329\u0353\u033C\u0326\u033A\u032B\u033A\u034D\u0324\u0329\u0353\u0318\u0332\u032A\u033A\u032A\u033A\u033A\u0353\u0321\u0349\u034D\u0355\u0356\u0333\u0326\u0317\u0345"),
							false);
			}
		}
		if (!world.getEntitiesOfClass(VillagrrEntity.class, AABB.ofSize(new Vec3(x, y, z), 1000, 1000, 1000), e -> true).isEmpty()) {
			puntero2 = 0.5;
			world.addParticle((SimpleParticleType) (Ashes1ashesModParticleTypes.PUNTO_BLANCO.get()), (entity.getX() + entity.getLookAngle().x * puntero2), (entity.getY() + 1.62 + entity.getLookAngle().y * puntero2),
					(entity.getZ() + entity.getLookAngle().z * puntero2), 0, 0, 0);
			if (world instanceof ServerLevel _level)
				_level.getServer().getCommands().performPrefixedCommand(new CommandSourceStack(CommandSource.NULL, new Vec3(x, y, z), Vec2.ZERO, _level, 4, "", Component.literal(""), _level.getServer(), null).withSuppressedOutput(), "stopsound @a");
		}
	}
}
